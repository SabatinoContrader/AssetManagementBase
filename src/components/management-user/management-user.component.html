<html>
<body>
  <!--<div style="width: 100%">-->
<div>
    <app-menu-customer></app-menu-customer>
</div>

<div class="bordo rcorners" style="width:fit-content;text-align: center;">

  <table style="border-collapse:collapse;">

      <caption>
          <th><h1>Users</h1></th>
          </caption>

      <tr class="border_bottom">
      
      <th>
        ID utente
      </th>
      <th>
        Username
      </th>
    
      <th>
        Password
      </th>
      <th>
        Ragione Sociale
      </th>
      <th>
        Telefono
      </th>
      <th>
        Email
      </th>
      <th>
        Partita Iva
      </th>
      <th>
        Ruolo
      </th>
      <th>
        Nome Abbonamento
      </th>
      <th>
      </th>
      <th>
      </th>
   
    </tr>


     
    
    <tr *ngFor="let user of utenti; let idx = index;">
        
      <td> 
    
        <input type="text" value="{{user.iduser}}" class="labcor labtext" size="2" disabled>
    
      </td>
      <td>
       
          <input name="usernameMod" [ngStyle]="!mapValidator[idx].get('username') && {'border-color': 'red','color': 'red'}" 
          [(ngModel)]="utenti[idx].username" (ngModelChange)="valModUsername($event,idx)" type="text" class="labcor labtext" 
          size="10" [disabled]="disabledRow[idx]" title="Da 4 a 10 elementi">
          <!--<p style="color: red" *ngIf="!mapValidator[idx].get('username')">Username sbagliato</p>-->
      </td>
      <td>
          <input name="passwordMod" [ngStyle]="!mapValidator[idx].get('password') && {'border-color': 'red','color': 'red'}" 
          (ngModelChange)="valModPassword($event,idx)"  [(ngModel)]="utenti[idx].password" type="text" class="labcor labtext" 
          size="10" [disabled]="disabledRow[idx]" title="Da 4 a 10 elementi">
      </td>
    
      <td>
        <!--Se uso direttamente [(ngModel)] mi fa vedere in tutte le righe l'ultimo valore dell'array utenti, per questo l'ho
        sdoppiato. idx mi permette, invece, di ottente l'indice (number) del ciclo.-->
          <input name="ragioneSocialeMod" [value]="utenti[idx].ragioneSociale" (input)="utenti[idx].ragioneSociale=$event.target.value"
          type="text"  class="labcor labtext" size="10" [disabled]="disabledRow[idx]">
      </td>
    
      <td>
          <input name="telefonoMod" [ngStyle]="!mapValidator[idx].get('telefono') && {'border-color': 'red','color': 'red'}" 
          [(ngModel)]="utenti[idx].telefono" (ngModelChange)="valModTelefono($event,idx)" type="text" class="labcor labtext" size="10" 
          [disabled]="disabledRow[idx]" title="Valori accettati: [1234567890] [+391234567890] [+39 1234567890]">
          
      </td>
      <td>
          <input name="mailMod" [ngStyle]="!mapValidator[idx].get('email') && {'border-color': 'red','color': 'red'}" 
          [(ngModel)]="utenti[idx].mail" type="text" (ngModelChange)="valModEmail($event,idx)" class="labcor labtext" size="15" 
          [disabled]="disabledRow[idx]" title="Da 4 a 10 elementi" title="Valori accettati: qualsiasi@qualsiasi">
      </td>
      <td>
          <input name="partitaivaMod" [ngStyle]="!mapValidator[idx].get('partitaIva') && {'border-color': 'red','color': 'red'}" 
          [(ngModel)]="utenti[idx].partitaiva" type="text" (ngModelChange)="valModPartitaIva($event,idx)" class="labcor labtext" 
          size="11" [disabled]="disabledRow[idx]" title="11 numeri">
      </td>
      <td>
          <select id="ruoloMod" name="ruoloMod" class="labcor labtext" [disabled]="disabledRow[idx]" (input)="utenti[idx].ruolo=$event.target.value">
              <option value="cliente" [selected]="utenti[idx].ruolo=='gold'">cliente</option>
              <option value="segretaria" [selected]="utenti[idx].ruolo=='segretaria'">segretaria</option>
          </select>
          <!--
          <input name="ruolo" [value]="utenti[idx].ruolo" (input)="utenti[idx].ruolo=$event.target.value" type="text" class="labcor labtext" size="12" [disabled]="disabledRow[idx]">
          -->
      </td>
      <td>
          <!--Il tag select non ha un value quindi, in automatico, l'evento (input) resta in ascolto su tutti gli <option> di quel
          <select>-->
          <select id="userMod" name = "abbonamentoMod" [disabled]="disabledRow[idx]" class="labcor labtext" (input)="utenti[idx].abbonamento.id=$event.target.value">
            <option value ="3" [selected]="utenti[idx].abbonamento.nome=='gold'">gold</option>
            <option value ="2" [selected]="utenti[idx].abbonamento.nome=='silver'">silver</option>
            <option value ="1" [selected]="utenti[idx].abbonamento.nome=='normale'">normale</option>
            <option value ="4"  [selected]="utenti[idx].abbonamento.nome=='business'">business</option></select>

      </td>
    
      <div *ngIf="visButton">
      <td>   
        <Button class="button button1" (click)="modify($event, idx)"><img width="20" height="20"  src="../assets/images/Edit.png" /></Button>
       </td>
       <td>
        <Button class="button button3" (click)="delete($event, user.iduser)"><img width="20" height="20"  src="../assets/images/remove.jpg" /></Button>
       </td>
      </div>

      <div *ngIf="!disabledRow[idx]">
        <td>   
          <Button class="button button1" (click)="applyModify($event,idx, user.iduser)"
          [disabled]="!mapValidator[idx].get('username') || !mapValidator[idx].get('password') ||
           !mapValidator[idx].get('ragioneSociale') || !mapValidator[idx].get('telefono') || !mapValidator[idx].get('email') ||
           !mapValidator[idx].get('partitaIva')"><img width="20" height="20"  src="../assets/images/ok.png" /></Button>
        </td>
        <td>   
            <Button class="button button3" (click)="annulla($event)"><img width="20" height="20"  src="../assets/images/delete.png" /></Button>
          </td>
      </div>
      
    </tr>
   
    
    <tr *ngIf="visInsert"> 

        <td>
          <input type="text" value="-" class="labcor labtext" size="2" disabled>
        </td>
        <td> 
          <input name="username" [ngStyle]="!validationRow[1] && {'border-color': 'red','color': 'red'}" [(ngModel)]="insertUtente.username" (ngModelChange)="valInsUsername($event)" type="text"
            title="Da 4 a 10 elementi" class="labcor labtext" size="10">
        </td>
        <td>
          <input name="password" [ngStyle]="!validationRow[2] && {'border-color': 'red','color': 'red'}" [(ngModel)]="insertUtente.password" (ngModelChange)="valInsPassword($event)" type="text"
          title="Da 4 a 10 elementi" class="labcor labtext" size="10">
        </td>
        
        <td>
          <input name="ragioneSociale" value="" (input)="insertUtente.ragioneSociale=$event.target.value"
            type="text" class="labcor labtext" size="10">
        </td>
        
        <td> 
          <input name="telefono" [ngStyle]="!validationRow[4] && {'border-color': 'red','color': 'red'}" [(ngModel)]="insertUtente.telefono" (ngModelChange)="valInsTelefono($event)" type="text"
          title="Valori accettati: [1234567890] [+391234567890] [+39 1234567890]" class="labcor labtext" size="10">
        </td>
       
        <td>
          <input name="mail" [ngStyle]="!validationRow[5] && {'border-color': 'red','color': 'red'}" [(ngModel)]="insertUtente.mail" (ngModelChange)="valInsMail($event)" type="text" class="labcor labtext"
          title="Valori accettati: qualsiasi@qualsiasi" size="15">
        </td>
        <td>
          <input name="partitaiva" [ngStyle]="!validationRow[6] && {'border-color': 'red','color': 'red'}" 
          [(ngModel)]="insertUtente.partitaiva" (ngModelChange)="valInsPartitaIva($event)" type="text"
          title="11 numeri" class="labcor labtext" size="11">
        </td>
        <td>
          <select id="ruolo" name="ruolo" class="labcor labtext" (input)="insertUtente.ruolo=$event.target.value">
              <option value="cliente" selected>cliente</option>
              <option value="segretaria">segretaria</option>
          </select>
          
 
        </td>
        <td>
          <select id="abbonamento" name="abbonamento" class="labcor labtext" (input)="insertUtente.abbonamento.id=$event.target.value">
            <option value="3" selected>gold</option>
            <option value="2">silver</option>
            <option value="1">normale</option>
            <option value="4">business</option>
          </select>
         
        </td> 

        <!--Se un validationRow[x] resituisce false (nessun match con la regex) il tasto diventa disabilitato-->

            <td *ngIf="visInsert">
              <Button class="button button1" (click)="applyInsert($event)" [disabled]=
              "!validationRow[0] || !validationRow[1] || !validationRow[2] || !validationRow[3] || !validationRow[4] || !validationRow[5]
              || !validationRow[6] || !validationRow[7]|| !validationRow[8]"><img width="20" height="20"  src="../assets/images/ok.png" /></Button>
            </td>
            <td *ngIf="visInsert">
                <Button class="button button3" (click)="annulla($event)"><img width="20" height="20"  src="../assets/images/delete.png" /></Button>
              </td>

    </tr>

  </table>
    <Button *ngIf="!visInsert && visButton"  class="button button1" (click)="insert($event)">Inserisci</Button>
    

  

</div>

<!--</div>-->
  </body>
  </html>